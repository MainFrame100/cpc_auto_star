# Проект: CPC Auto Helper (Стартовый этап MVP)

## 1. Общее Описание

**Цель:** Разработка веб-приложения (SaaS) для помощи специалистам по контекстной рекламе Яндекс.Директ. Сервис должен автоматизировать рутинные задачи сбора/анализа статистики и предоставлять рекомендации.

**Технологический стек (Старт MVP):**
*   **Backend:** Python 3.x, Flask
*   **HTTP Запросы:** Requests
*   **Конфигурация:** python-dotenv (для `.env` файла)
*   **Frontend:** Простейший HTML, генерируемый напрямую из Flask (без JS-фреймворков на данном этапе).
*   **База данных:** НЕ ИСПОЛЬЗУЕТСЯ на данном этапе.

**Окружение Разработки:**
*   **ОС:** Windows 10/11
*   **Python:** Версия 3.x (установлен)
*   **Виртуальное окружение:** Используется `venv`, расположено в `C:\python\cpc_auto_star\venv\`
*   **Менеджер пакетов:** `pip`

**Структура проекта:**
C:\python\cpc_auto_star
├── venv\ # Виртуальное окружение
├── .env # Ключи API Яндекса (YANDEX_CLIENT_ID, YANDEX_CLIENT_SECRET) - СОЗДАН, ЗАПОЛНЕН
├── .gitignore # Правила игнорирования для Git - СОЗДАН
├── app.py # Основной файл приложения Flask - СОЗДАН (пустой или начальный)
├── requirements.txt # Список зависимостей - СОЗДАН (содержит flask, requests, python-dotenv)
└── PROJECT_README.md # Этот файл


## 2. Текущий Статус (Что уже сделано)

*   [x] Создана структура папок проекта.
*   [x] Инициализировано виртуальное окружение `venv`.
*   [x] Установлены базовые зависимости: `Flask`, `requests`, `python-dotenv` (зафиксированы в `requirements.txt`).
*   [x] Создан и заполнен файл `.env` с `YANDEX_CLIENT_ID` и `YANDEX_CLIENT_SECRET`.
*   [x] Создан файл `.gitignore` (игнорирует `venv/`, `__pycache__/`, `*.pyc`, `.env`).
*   [x] Создан пустой файл `app.py`.
*   [x] Получены Client ID и Client Secret от Яндекс OAuth.
*   [ ] Реализован базовый Flask сервер.
*   [ ] Реализован редирект на страницу авторизации Яндекс OAuth.
*   [ ] Реализован callback-обработчик для получения `code` от Яндекса.
*   [ ] Реализован обмен `code` на `access_token`.
*   [ ] Реализован первый тестовый запрос к API Директа с использованием `access_token`.

## 3. ЗАДАЧА ДЛЯ CURSOR НА СЕЙЧАС: Реализация Базового OAuth Флоу (Шаг 1: Получение `code`)

**Цель:** Написать код в файле `app.py` для запуска простого Flask-сервера, который позволяет пользователю инициировать процесс авторизации через Яндекс OAuth и получает обратно `authorization code`.

**Требования к коду в `app.py`:**

1.  **Импорты:** Импортировать `Flask`, `redirect`, `request`, `url_for`, `session` из `flask`; `os`; `requests`; `load_dotenv`.
2.  **Загрузка `.env`:** Вызвать `load_dotenv()` для загрузки переменных окружения.
3.  **Инициализация Flask:** Создать экземпляр `app = Flask(__name__)`.
4.  **Секретный ключ Flask:** **Обязательно** установить `app.secret_key`. Можно использовать `os.urandom(24)` или любую другую надежную случайную строку. Это нужно для работы `session`.
5.  **Роут `/` (Главная страница):**
    *   Метод: `GET`
    *   Логика: Возвращает простой HTML. HTML должен содержать заголовок (например, "CPC Auto Helper - Вход") и ссылку (тег `<a>`).
    *   Текст ссылки: "Войти через Яндекс".
    *   `href` ссылки: Должен указывать на URL, генерируемый `url_for('login_yandex')`.
6.  **Роут `/login/yandex`:**
    *   Метод: `GET`
    *   Логика:
        *   Прочитать `YANDEX_CLIENT_ID` из переменных окружения (`os.getenv('YANDEX_CLIENT_ID')`).
        *   Сформировать URL для редиректа на `https://oauth.yandex.ru/authorize`.
        *   Параметры URL:
            *   `response_type=code`
            *   `client_id=ВАШ_CLIENT_ID` (из `.env`)
            *   `redirect_uri=http://127.0.0.1:5000/oauth/callback` (Убедись, что этот URL совпадает с тем, что указан в настройках приложения Яндекс OAuth!)
        *   Использовать `redirect()` из Flask для перенаправления пользователя на сформированный URL.
7.  **Роут `/oauth/callback`:**
    *   Метод: `GET`
    *   Логика:
        *   Получить значение параметра `code` из строки запроса: `code = request.args.get('code')`.
        *   Получить значение параметра `state` (если передавали, пока не обязательно).
        *   Проверить, есть ли `code`.
        *   **Если `code` есть:** Вернуть HTML с сообщением "Успешно! Получен код: [значение кода]".
        *   **Если `code` нет (или есть ошибка в параметрах `error`):** Вернуть HTML с сообщением об ошибке (например, "Ошибка авторизации: [текст ошибки из параметра error]").
8.  **Запуск сервера:** Добавить в конец файла стандартный блок:
    ```python
    if __name__ == '__main__':
        app.run(host='127.0.0.1', port=5000, debug=True)
    ```
    *   `debug=True` включает режим отладки Flask (автоперезагрузка при изменении кода и показ ошибок в браузере).
    *   `host='127.0.0.1'` и `port=5000` - стандартные для локальной разработки.

**Важные Замечания для Cursor:**
*   Весь код пишем в одном файле `app.py`.
*   Никакой базы данных.
*   HTML можно генерировать прямо в Python-строках (f-string или `render_template_string`, если хочешь чуть чище). Не создавай отдельные HTML-файлы в папке `templates` пока.
*   Убедись, что секреты (Client ID, Client Secret) читаются из `.env` и не хардкодятся.
*   **Проверь, что `redirect_uri` в коде (`/login/yandex`) и в настройках приложения на Яндексе совпадают!** Это частая причина ошибок.

## 4. Следующие Шаги (После выполнения текущей задачи)

*   [ ] Реализовать обмен `code` на `access_token` и `refresh_token` в роуте `/oauth/callback`.
*   [ ] Сохранить токены (временно в `session` Flask).
*   [ ] Сделать первый тестовый запрос к API Директа (например, получить список кампаний) с использованием `access_token`.
*   [ ] Отобразить результат запроса к API на новой странице.