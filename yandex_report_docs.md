Как сформировать отчет
Выполните запрос к сервису Reports.

В HTTP-заголовке Authorization укажите OAuth-токен, полученный для пользователя, по кампаниям которого требуется получить статистику. Полный список заголовков приведен в разделе HTTP-заголовки.

В теле запроса укажите значения основных параметров в зависимости от того, какие данные вам нужны:

за какой период требуется получить отчет и по каким периодам нужно агрегировать данные;

какой тип отчета подходит для вашей задачи;

какие поля (столбцы) необходимо выводить в отчете;

в каком виде следует выводить денежные значения;

какие фильтры будут использоваться для отбора данных.

Полный список входных параметров представлен в разделе Запрос: спецификация отчета.

Отчеты с небольшим количеством данных формируются в режиме онлайн. В этом случае вы сразу получите HTTP-код ответа 200, а отчет будет передан в теле ответа.

Отчеты с большим количеством данных, а также некоторые типы отчетов формируются в режиме офлайн. В этом случае вы получите HTTP-код ответа 201.

Подробная схема запросов и ответов приведена в разделе Онлайн- и офлайн-отчет.

Чтобы получить отчет, который формируется в режиме офлайн, повторите запрос с теми же параметрами через некоторое время.

Если формирование отчета еще не завершено, вы получите HTTP-код ответа 202.

Если отчет готов, вы получите HTTP-код ответа 200, а отчет будет передан в теле ответа.


Период отчета
В параметре DateRangeType укажите период, за который требуется получить статистику:

TODAY — текущий день;

YESTERDAY — вчера;

LAST_3_DAYS, LAST_5_DAYS, LAST_7_DAYS, LAST_14_DAYS, LAST_30_DAYS, LAST_90_DAYS, LAST_365_DAYS — указанное количество предыдущих дней, не включая текущий день;

THIS_WEEK_MON_TODAY — текущая неделя начиная с понедельника, включая текущий день;

THIS_WEEK_SUN_TODAY — текущая неделя начиная с воскресенья, включая текущий день;

LAST_WEEK — прошлая неделя с понедельника по воскресенье;

LAST_BUSINESS_WEEK — прошлая рабочая неделя с понедельника по пятницу;

LAST_WEEK_SUN_SAT — прошлая неделя с воскресенья по субботу;

THIS_MONTH — текущий календарный месяц;

LAST_MONTH — полный предыдущий календарный месяц;

ALL_TIME — вся доступная статистика, включая текущий день;

CUSTOM_DATE — произвольный период. При выборе этого значения необходимо указать даты начала и окончания периода в параметрах DateFrom и DateTo.

AUTO — период, за который статистика показов и кликов могла измениться. Период выбирается автоматически в зависимости от того, произошла ли в предыдущий день корректировка статистики. Подробнее см. в разделе Как получить актуальную статистику.

Данные в отчете можно агрегировать по различным периодам. Для этого укажите в параметре FieldNames одно из значений Date, Week, Month, Quarter или Year.

Тип отчета
В параметре ReportType укажите тип отчета. Тип отчета влияет на набор доступных полей и группировку данных.

Например, если выбран тип отчета SEARCH_QUERY_PERFORMANCE_REPORT, то данные в отчете будут сгруппированы по идентификатору группы AdGroupId и поисковому запросу Query. Обратите внимание, что добавление группировок данных не приводит к автоматическому добавлению соответствующих полей в отчет: отчет содержит только поля, явным образом перечисленные в параметре FieldNames.

Наиболее общий тип отчета — CUSTOM_REPORT. Он не добавляет никаких дополнительных группировок.

Типы отчетов представлены в таблице.

Тип отчета

Описание

Добавляется группировка данных

Не допускаются поля

ACCOUNT_PERFORMANCE_REPORT

Статистика по аккаунту рекламодателя

–

См. раздел Допустимые поля

CAMPAIGN_PERFORMANCE_REPORT

Статистика по кампаниям

CampaignId

См. раздел Допустимые поля

ADGROUP_PERFORMANCE_REPORT

Статистика по группам объявлений

AdGroupId

См. раздел Допустимые поля

AD_PERFORMANCE_REPORT

Статистика по объявлениям

AdId

AudienceTargetId, Criteria, CriteriaId, Criterion, CriterionId, DynamicTextAdTargetId, Keyword, Query, RlAdjustmentId, SmartAdTargetId

CRITERIA_PERFORMANCE_REPORT

Статистика по условиям показа

AdGroupId, CriteriaId, CriteriaType

AdFormat, AdId, Placement, Query

CUSTOM_REPORT

Статистика с произвольными группировками

–

Query

REACH_AND_FREQUENCY_PERFORMANCE_REPORT

Статистика по медийным кампаниям.

Отчет содержит только данные по кампаниям с типом “Медийная кампания”“Display campaign”, кампании остальных типов игнорируются

В запросе на формирование отчета необходимо указать в поле FieldNames значение CampaignId

См. раздел Допустимые поля

SEARCH_QUERY_PERFORMANCE_REPORT

Статистика по поисковым запросам

AdGroupId, Query

См. раздел Допустимые поля

Поля отчета
В параметре FieldNames укажите, какие поля (столбцы) следует выводить в отчете.

Если требуется, укажите в параметре OrderBy поля, по которым нужно отсортировать данные, и направление сортировки.

Какие поля допустимы для каждого типа отчета и по каким полям возможна сортировка — см. в разделе Допустимые поля ниже.

Вывод денежных значений
Валюта отчета
Денежные значения выводятся в валюте рекламодателя.

Единицы измерения
Денежные значения в полях AvgCpc, AvgCpm, AvgEffectiveBid, Cost, CostPerConversion, Profit, Revenue представляют собой:

Суммы в валюте, если в запросе указан HTTP-заголовок returnMoneyInMicros: false. Округляются до двух знаков после запятой.
Целые числа — результат умножения суммы в валюте на 1 000 000, если заголовок не указан. Округляются до 10 000.
Примечание

Из-за погрешности округления результаты суммирования значений полей Cost и Profit по строкам отчета могут незначительно отличаться от истинных итоговых значений. Итоговые значения можно получить, сформировав агрегированный отчет (без дополнительных группировок данных).

НДС
Денежные значения в полях AvgCpc, AvgCpm, AvgEffectiveBid, Cost, CostPerConversion, а также Profit и Revenue по ключевым целям кампании можно получить с учетом или без учета НДС, используя входной параметр IncludeVAT.

Значение Revenue, рассчитанное по данным Яндекс Метрики, не зависит от параметра IncludeVAT.

Фильтрация данных
Для фильтрации данных в отчете используйте структуры Filter. Каждый фильтр представляет собой критерий отбора данных. Фильтры объединяются по условию AND: в отчет попадают данные, для которых выполнены все фильтры. Фильтр состоит из трех параметров:

Field — значение какого поля сравнивается;
Operator — каким образом сравнивается;
Values — массив символьных значений, с которыми выполняется сравнение.
Например, чтобы отобрать в отчет строки, в которых количество целевых визитов больше 10, используйте фильтр

"Filter": [{
"Field": "Conversions",
"Operator": "GREATER_THAN",
"Values": ["10"]
}]

Соответствие полей и операторов представлено в таблице.

Имя поля

Доступные операторы

AdNetworkType

EQUALS, IN

CampaignId

CampaignType

ClientLogin

AdFormat

EQUALS, IN, NOT_EQUALS, NOT_IN

AdGroupId

AdId

Age

AudienceTargetId

CarrierType

ClickType

CriteriaType

CriterionType

Device

DynamicTextAdTargetId

ExternalNetworkName

Gender

IncomeGrade

LocationOfPresenceId

MatchType

MobilePlatform

Placement

RlAdjustmentId

Slot

SmartAdTargetId

TargetingCategory

TargetingLocationId

EQUALS, IN, GREATER_THAN, LESS_THAN

Clicks

Conversions

ImpressionReach

GREATER_THAN, LESS_THAN

Impressions

AvgClickPosition

AvgCpc

AvgCpm

AvgEffectiveBid

AvgImpressionFrequency

AvgImpressionPosition

AvgPageviews

AvgTrafficVolume

BounceRate

ConversionRate

Cost

CostPerConversion

Ctr

GoalsRoi

Profit

Revenue

WeightedCtr

WeightedImpressions

Keyword

EQUALS, IN, NOT_EQUALS, NOT_IN, STARTS_WITH_IGNORE_CASE, STARTS_WITH_ANY_IGNORE_CASE, DOES_NOT_START_WITH_IGNORE_CASE, DOES_NOT_START_WITH_ALL_IGNORE_CASE

MatchedKeyword

Query

Фильтр по полю ClientLogin
В фильтре ClientLogin можно указывать только логины клиентов, доступные управляющему аккаунту.

Если фильтр по полю не задан, то по умолчанию используется логин из HTTP-заголовка Client-Login. При отсутствии заголовка берется логин из OAuth-токена.
Если фильтр по ClientLogin задан, максимальное число строк в отчете — 500000 (это же значение используется по умолчанию).
Фильтр по полю Age
В поле Age в статистике за период до 21.08.2018 выводится значение AGE_45, за период после 21.08.2018 — значения AGE_45_54 и AGE_55.

Чтобы получить статистику по всем пользователям от 45 лет независимо от периода отчета, рекомендуем указать в фильтре по полю Age все три значения:

"Filter": [{
"Field": "Age",
"Operator": "IN",
"Values": ["AGE_45", "AGE_45_54", "AGE_55"]
}]

Если в фильтре указаны не все срезы, то статистика за период, включающий дату 21.08.2018, может оказаться неполной. Например, если указаны только значения AGE_45_54 и AGE_55, в отчет не попадут пользователи, чья возрастная группа определена как AGE_45.

Если в фильтре указано значение AGE_45 и не указаны AGE_45_54 и AGE_55, то отчет за период после 21.08.2018 не будет сформирован и будет выдано сообщение об ошибке.

Фильтры по условиям показа
Следующие поля не выводятся в отчете и используются только для фильтрации данных. Поля являются взаимоисключающими: только одно из них может присутствовать в массиве Filter.

Поле

Описание

Коментарий

Keyword

Текст ключевой фразы.

Текст ключевой фразы выводится в отчете в поле Criterion, идентификатор ключевой фразы — в поле CriterionId.

AudienceTargetId

Идентификатор условия нацеливания на аудиторию. См. раздел Условие нацеливания на аудиторию (AudienceTarget).

Идентификатор условия нацеливания на аудиторию выводится в поле CriterionId. В поле Criterion выводится название условия ретаргетинга и подбора аудитории.

Фильтрация по AudienceTargetId доступна для данных начиная с 08.12.2017.

DynamicTextAdTargetId

Идентификатор условия нацеливания для динамических объявлений или идентификатор фильтра для динамических объявлений. См. раздел Условие нацеливания для динамических объявлений (DynamicTextAdTarget — Webpage).

Идентификатор условия нацеливания для динамических объявлений выводится в отчете в поле CriterionId, название — в поле Criterion.

SmartAdTargetId

Идентификатор фильтра для смарт-баннеров.

Идентификатор фильтра для смарт-баннеров выводится в отчете в поле CriterionId, название — в поле Criterion.

Фильтр по RlAdjustmentId
В фильтре по полю RlAdjustmentId можно использовать значение NONE, которое означает, что корректировка ставок для целевой аудитории не была применена.

В частности, чтобы отобрать в отчет только данные с корректировками для целевой аудитории, используйте фильтр

"Filter": [{
"Field": "RlAdjustmentId",
"Operator": "NOT_EQUALS",
"Values": ["NONE"]
}]

Фильтры по денежным значениям
Все денежные значения в фильтрах следует указывать в виде целых чисел: сумм в валюте, умноженных на 1 000 000 (независимо от наличия заголовка returnMoneyInMicros: false).


HTTP-заголовки
Заголовки запроса
В дополнение к заголовкам Authorization, Accept-Language, Client-Login можно указать следующие заголовки:

processingMode
Режим формирования отчета: online, offline или auto. Отсутствие заголовка эквивалентно значению auto. Описание режимов приведено в разделе Онлайн- и офлайн-отчет.

returnMoneyInMicros: false
Если заголовок указан, денежные значения в отчете возвращаются в валюте с точностью до двух знаков после запятой. Если не указан, денежные значения возвращаются в виде целых чисел — сумм в валюте, умноженных на 1 000 000.

skipReportHeader: true
Не выводить в отчете строку с названием отчета и диапазоном дат.

skipColumnHeader: true
Не выводить в отчете строку с названиями полей.

skipReportSummary: true
Не выводить в отчете строку с количеством строк статистики.

Accept-Encoding: gzip
Если заголовок указан, применяется сжатие gzip.

Заголовки ответа
Если отчет формируется в режиме офлайн, то в дополнение к заголовку RequestId возвращается следующий заголовок:

retryIn
Рекомендуемый интервал в секундах для проверки готовности отчета.

reportsInQueue
Количество офлайн-отчетов, находящихся в очереди на формирование (не более 5 отчетов для одного рекламодателя).


Запрос: спецификация отчета
Параметры отчета указываются в теле запроса в формате JSON или XML.

Структура параметров:

{
  "params" : { /* ReportDefinition */
      "SelectionCriteria": { /* SelectionCriteria */
      "DateFrom": (string),
      "DateTo": (string),
      "Filter": [{ /* FilterItem*/
          "Field": ( "AdGroupId" | ... | "Year" ),  /* required */
          "Operator": ( "EQUALS" | ... | "STARTS_WITH_IGNORE_CASE" ), /* required */
          "Values": [(string), ... ] /* required */
      }, ... ]
      }, /* required */
      "Goals": [(string), ... ],
      "AttributionModels": [( "FC" | "LC" | "LSC" | "LYDC" | "FCCD" | "LSCCD" | "LYDCCD" | "AUTO" ), ... ],
      "FieldNames": [( "AdGroupId" | ... | "Year" ), ... ],  /* required */
      "Page": { /* Page*/
      "Limit": (int) /* required */
      "Offset": (int)
      }
      "OrderBy": [{ /* OrderBy*/
      "Field": ( "AdGroupId" | ... | "Year" ),  /* required */
      "SortOrder": ( "ASCENDING" | "DESCENDING" )
      }, ... ],
      "ReportName": (string),  /* required */
      "ReportType": ( "ACCOUNT_PERFORMANCE_REPORT" | ... | "SEARCH_QUERY_PERFORMANCE_REPORT" ),  /* required */
      "DateRangeType": ( "ALL_TIME" | ... | "YESTERDAY" ),  /* required */
      "Format": ( "TSV" ),  /* required */
      "IncludeVAT": ( "YES" | "NO" ),  /* required */
      "IncludeDiscount": ( "YES" | "NO" ) 
  }
}


Параметр

Тип

Описание

Обязательный

Структура ReportDefinition

SelectionCriteria

SelectionCriteria

Критерии отбора данных для отчета.

Да

Goals

array of string

Идентификаторы целей Яндекс Метрики, по которым требуется получить статистику (см. раздел Что такое цели. Типы целей помощи Яндекс Метрики). Не более 10 элементов в массиве.

Если параметр указан, то в отчете вместо полей ConversionRate, Conversions, CostPerConversion, GoalsRoi и Revenue с агрегированными данными по всем целям будут выведены аналогичные поля с именами вида <поле>_<id_цели>_<модель_атрибуции> и данными по каждой цели в отдельности.

См. также Пример: данные Яндекс Метрики.

Нет

AttributionModels

array of AttributionModelEnum

Модели атрибуции, используемые при расчете данных по целям Яндекс Метрики (см. раздел Модели атрибуции помощи Директа).
Возможные значения:

FC — первый переход.
LC — последний переход.
LSC — последний значимый переход.
LYDC — последний переход из Яндекс Директа.
FCCD – первый переход кросс-девайс.
LSCCD – последний значимый переход кросс-девайс.
LYDCCD – последний переход из Яндекс Директа кросс-девайс.
AUTO – автоматическая атрибуция.
Значение по умолчанию — AUTO.

Если указано несколько моделей атрибуции, данные будут выведены по каждой модели в отдельности.

Примечание

При использовании моделей атрибуции LYDC, LSC и FC датой визита считается не дата фактического посещения сайта, а дата клика, который является источником визита. Таким образом, визит и его данные (глубина просмотра, достижение цели, доход и т. д.) будут отражены в отчете, если дата клика попадает в период отчета.

При повторном получении отчета за тот же период с теми же параметрами данные Метрики в отчете могут измениться, если с момента предыдущего получения отчета произошли визиты, источником которых являются клики, совершенные в период отчета.

Нет

FieldNames

array of FieldEnum

Имена полей (столбцов), которые будут присутствовать в отчете.

Какие поля можно указывать, см. в разделах Допустимые поля, Несовместимые поля и зависимости.

Для типа отчета REACH_AND_FREQUENCY_PERFORMANCE_REPORT поле CampaignId обязательно.

Да

Page

Page

Ограничение на количество строк в отчете. Если не задано, используется ограничение 1 000 000.

Нет

OrderBy

array of OrderBy

Имена полей (столбцов), по которым требуется отсортировать строки в отчете.

Нет

ReportName

string

Название отчета. Выводится в первой строке отчета.

В режиме офлайн название отчета должно быть уникальным для рекламодателя. Если отчет с таким названием, но с отличающимися параметрами уже сформирован или находится в очереди, выдается ошибка.

Да

ReportType

ReportTypeEnum

Тип отчета. См. раздел Тип отчета выше.

Да

DateRangeType

DateRangeTypeEnum

Период, за который формируется отчет. См. раздел Период отчета выше.

Да

Format

FormatEnum

Формат отчета. В настоящее время поддерживается только значение TSV.

Да

IncludeVAT

YesNoEnum

Включать ли НДС в денежные суммы в отчете.

Да

IncludeDiscount

YesNoEnum

Учитывать ли скидку для денежных сумм в отчете.
Параметр утратил актуальность, с 1 сентября 2015 года скидка в Директе не предоставляется.

Нет

Структура SelectionCriteria

DateFrom

string

Начальная дата отчетного периода, YYYY-MM-DD.

При значении CUSTOM_DATE параметра DateRangeType

DateTo

string

Конечная дата отчетного периода, YYYY-MM-DD.

Примечание

Параметры DateFrom и DateTo обязательны при значении CUSTOM_DATE параметра DateRangeType и недопустимы при других значениях.

При значении CUSTOM_DATE параметра DateRangeType

Filter

array of FilterItem

Фильтры. См. раздел Фильтрация данных выше.

Нет

Структура FilterItem

Field

FieldEnum

Имя поля, которое используется для фильтрации данных. Каждое поле можно использовать только в одном фильтре: несколько фильтров с одним и тем же полем не допускается.

Какие поля можно указывать, см. в разделах Допустимые поля, Несовместимые поля и зависимости.

Да

Operator

FilterOperatorEnum

Оператор, используемый для фильтрации данных:

EQUALS — значение поля равно значению из Values;
NOT_EQUALS — значение поля не равно значению из Values;
IN — значение поля равно любому значению из Values;
NOT_IN — значение поля не равно ни одному значению из Values;
LESS_THAN — значение поля меньше значения из Values;
GREATER_THAN — значение поля больше значения из Values;
STARTS_WITH_IGNORE_CASE — значение поля начинается с значения из Values;
DOES_NOT_START_WITH_IGNORE_CASE — значение поля не начинается с значения из Values;
STARTS_WITH_ANY_IGNORE_CASE — значение поля начинается с любого из значений, указанных в Values;
DOES_NOT_START_WITH_ALL_IGNORE_CASE — значение поля не начинается ни с одного из значений, указанных в Values.
Примечание

Операторы EQUALS, NOT_EQUALS, IN, NOT_IN для полей Keyword и Query не учитывают регистр, для остальных полей — учитывают регистр.

Операторы STARTS_WITH_IGNORE_CASE, DOES_NOT_START_WITH_IGNORE_CASE, STARTS_WITH_ANY_IGNORE_CASE, DOES_NOT_START_WITH_ALL_IGNORE_CASE не учитывают регистр.

Да

Values

array of string

Значения, используемые для фильтрации данных. Не более 10 000 элементов в массиве.

Все денежные значения следует указывать в виде целых чисел: сумм в валюте, умноженных на 1 000 000 (независимо от наличия заголовка returnMoneyInMicros: false).

Да

Структура Page

Limit

int

Максимальное количество строк в отчете.

Да

Offset

int

Количество строк, которое должно быть пропущено при выборке.

Нет

Структура OrderBy

Field

FieldEnum

Имя поля, которое используется для сортировки.

Какие поля можно указывать, см. в разделах Допустимые поля, Несовместимые поля и зависимости.

Да

SortOrder

OrderBySortOrderEnum

Направление сортировки:

ASCENDING — по возрастанию;
DESCENDING — по убыванию.
Если не задано, выполняется сортировка по возрастанию.

Нет


Допустимые поля
Поля указываются в следующих параметрах отчета:

FieldNames — поля, которые выводятся в отчете (столбцы);
Field в структуре Filter — поля, которые используются для фильтрации данных в отчете;
Field в структуре OrderBy — поля, которые используются для сортировки строк в отчете.
Наборы допустимых полей в этих параметрах различаются (см. таблицу ниже). Например, поле CampaignName может быть добавлено как столбец в отчете, но не может использоваться для фильтрации данных, а поле Keyword — наоборот, используется только для фильтрации данных и в отчете не выводится.

Тип отчета также влияет на набор допустимых полей и их назначение (см. таблицу ниже):

фильтр — поле используется только для фильтрации данных и не может быть выведено в отчете;
сегмент — при выводе в отчете поле используется для группировки данных;
метрика — поле содержит числовое значение, рассчитанное в соответствии с заданными фильтрами и группировками;
атрибут — поле содержит фиксированное значение в соответствии с заданными группировками, добавление такого поля в отчет не приводит к появлению новой группировки.
Например, поле CampaignId для типа отчета CUSTOM_REPORT является сегментом: если его добавить в отчет, данные будут сгруппированы по кампаниям. А для типа отчета ADGROUP_PERFORMANCE_REPORT поле CampaignId является атрибутом: данные уже сгруппированы по AdGroupId, а идентификатор кампании является для каждой группы фиксированным значением.

Прочерк «–» означает, что в соответствующем параметре или типе отчета это поле использовать нельзя.

Параметры

Типы отчетов

Имя поля

FieldNames

Filter.Field

OrderBy.Field

ACCOUNT_PERFORMANCE_REPORT

AD_PERFORMANCE_REPORT

ADGROUP_PERFORMANCE_REPORT

CAMPAIGN_PERFORMANCE_REPORT

CRITERIA_PERFORMANCE_REPORT

CUSTOM_REPORT

REACH_AND_FREQUENCY_PERFORMANCE_REPORT

SEARCH_QUERY_PERFORMANCE_REPORT

AdFormat

+

+

+

сегмент

сегмент

сегмент

сегмент

–

сегмент

–

–

AdGroupId

+

+

+

–

атрибут

атрибут

–

атрибут

сегмент

сегмент

атрибут

AdGroupName

+

–

+

–

атрибут

атрибут

–

атрибут

сегмент

сегмент

атрибут

AdId

+

+

+

–

атрибут

–

–

–

сегмент

сегмент

сегмент

AdNetworkType

+

+

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

–

–

Age

+

+

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

–

AudienceTargetId

–

+

–

–

–

–

–

фильтр

фильтр

–

–

AvgClickPosition

+

+

+

метрика

метрика

метрика

метрика

метрика

метрика

–

метрика

AvgCpc

+

+

+

метрика

метрика

метрика

метрика

метрика

метрика

метрика

метрика

AvgCpm

+

+

+

–

–

–

–

–

–

метрика –

AvgEffectiveBid

+

+

+

метрика

метрика

метрика

метрика

метрика

метрика

метрика

метрика

AvgImpressionFrequency

+

+

+

–

–

–

–

–

–

метрика –

AvgImpressionPosition

+

+

+

метрика

метрика

метрика

метрика

метрика

метрика

–

метрика

AvgPageviews

+

+

+

метрика

метрика

метрика

метрика

метрика

метрика

метрика

метрика

AvgTrafficVolume

+

+

+

метрика

метрика

метрика

метрика

метрика

метрика

метрика

метрика

AvgVideoCompleteCost

+

+

+

–

–

–

–

–

–

метрика –

BounceRate

+

+

+

метрика

метрика

метрика

метрика

метрика

метрика

метрика

метрика

Bounces

+

–

+

метрика

метрика

метрика

метрика

метрика

метрика

метрика

метрика

CampaignId

+

+

+

–

атрибут

атрибут

атрибут

атрибут

сегмент

сегмент

атрибут

CampaignName

+

–

+

–

атрибут

атрибут

атрибут

атрибут

сегмент

сегмент

атрибут

CampaignUrlPath

+

–

+

–

атрибут

атрибут

атрибут

атрибут

сегмент

сегмент

атрибут

CampaignType

+

+

+

сегмент

атрибут

атрибут

атрибут

атрибут

сегмент

сегмент

атрибут

CarrierType

+

+

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

–

–

Clicks

+

+

+

метрика

метрика

метрика

метрика

метрика

метрика

метрика

метрика

ClickType

+

+

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

–

–

ClientLogin

+

+

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

ConversionRate

+

+

+

метрика

метрика

метрика

метрика

метрика

метрика

метрика

метрика

Conversions

+

+

+

метрика

метрика

метрика

метрика

метрика

метрика

метрика

метрика

Cost

+

+

+

метрика

метрика

метрика

метрика

метрика

метрика

метрика

метрика

CostPerConversion

+

+

+

метрика

метрика

метрика

метрика

метрика

метрика

метрика

метрика

CPV

+

+

+

–

–

–

–

–

–

метрика –

Criteria

+

–

–

–

–

–

–

атрибут

сегмент

–

сегмент

CriteriaId

+

–

–

–

–

–

–

атрибут

сегмент

–

сегмент

CriteriaType

+

+

+

сегмент

сегмент

сегмент

сегмент

атрибут

сегмент

–

сегмент

Criterion

+

–

–

–

–

–

–

атрибут

сегмент

–

сегмент

CriterionId

+

–

–

–

–

–

–

атрибут

сегмент

–

сегмент

CriterionType

+

+

+

сегмент

сегмент

сегмент

сегмент

атрибут

сегмент

–

сегмент

Ctr

+

+

+

метрика

метрика

метрика

метрика

метрика

метрика

метрика

метрика

Date

+

–

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

Device

+

+

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент –

DynamicTextAdTargetId

–

+

–

–

–

–

–

фильтр

фильтр

–

фильтр

ExternalNetworkName

+

+

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

–

–

Gender

+

+

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент –

GoalsRoi

+

+

+

метрика

метрика

метрика

метрика

метрика

метрика

метрика

метрика

ImpressionReach

+

+

+

–

–

–

–

–

–

метрика –

Impressions

+

+

+

метрика

метрика

метрика

метрика

метрика

метрика

метрика

метрика

IncomeGrade

+

+

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

–

сегмент

Keyword

–

+

–

–

–

–

–

фильтр

фильтр

–

фильтр

LocationOfPresenceId

+

+

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

–

–

LocationOfPresenceName

+

–

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

–

–

MatchedKeyword

+

+

+

–

–

–

–

–

–

–

сегмент

MatchType

+

+

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

–

сегмент

MobilePlatform

+

+

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

–

–

Month

+

–

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

Placement

+

+

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

–

сегмент

Profit

+

+

+

метрика

метрика

метрика

метрика

метрик

метрика

метрика

метрика

Quarter

+

–

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

Query

+

+

+

–

–

–

–

–

–

–

атрибут

Revenue

+

+

+

метрика

метрика

метрика

метрика

метрика

метрика

метрика

метрика

RlAdjustmentId

+

+

+

–

–

–

–

сегмент

сегмент

–

–

Sessions

+

–

+

метрика

метрика

метрика

метрика

метрика

метрика

метрика

–

Slot

+

+

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

–

–

SmartAdTargetId

–

+

–

–

–

–

–

фильтр

фильтр

–

–

TargetingCategory

+

+

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

–

сегмент

TargetingLocationId

+

+

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

–

TargetingLocationName

+

–

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

–

VideoComplete

+

+

+

–

–

–

–

–

–

метрика

–

VideoCompleteRate

+

+

+

–

–

–

–

–

–

метрика

–

VideoFirstQuartile

+

+

+

–

–

–

–

–

–

метрика

–

VideoFirstQuartileRate

+

+

+

–

–

–

–

–

–

метрика

–

VideoMidpoint

+

+

+

–

–

–

–

–

–

метрика

–

VideoMidpointRate

+

+

+

–

–

–

–

–

–

метрика

–

VideoThirdQuartile

+

+

+

–

–

–

–

–

–

метрика

–

VideoThirdQuartileRate

+

+

+

–

–

–

–

–

–

метрика

–

VideoViews

+

+

+

–

–

–

–

–

–

метрика

–

VideoViewsRate

+

+

+

–

–

–

–

–

–

метрика

–

Week

+

–

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

WeightedCtr

+

+

+

метрика

метрика

метрика

метрика

метрика

метрика

метрика

метрика

WeightedImpressions

+

+

+

метрика

метрика

метрика

метрика

метрика

метрика

метрика

метрика

Year

+

–

+

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент

сегмент




Несовместимые поля и зависимости
Несовместимые поля
Поля Date, Week, Month, Quarter, Year являются взаимоисключающими: только одно из них может присутствовать в отчете.

Поля CriterionType, CriteriaType, AudienceTargetId, DynamicTextAdTargetId, Keyword, SmartAdTargetId являются взаимоисключающими: только одно из них можно использовать для фильтрации данных.

Поле ClickType несовместимо с полями Impressions, Ctr, AvgImpressionPosition, WeightedImpressions, WeightedCtr, AvgTrafficVolume.

Поля Criterion, CriterionId, CriterionType несовместимы с полями Criteria, CriteriaId, CriteriaType.

Зависимости
Если указано поле Placement, данные в отчете будут сгруппированы также по полю AdNetworkType.

Для кампаний с типом SMART_CAMPAIGN, если указано хотя бы одно из полей Criterion, CriterionId, Criteria, CriteriaId, или используется отбор данных по полю SmartAdTargetId, или выбран тип отчета CRITERIA_PERFORMANCE_REPORT, то в полях Impressions и Ctr будет указан прочерк.


Содержание отчета
Отчет формируется в формате TSV.

Первая строка отчета содержит название отчета, заданное в параметре ReportName, и даты начала и окончания отчетного периода. Строка не выводится, если в запросе указан HTTP-заголовок skipReportHeader: true.

Вторая строка содержит наименования полей (столбцов), заданные в параметре FieldNames. Строка не выводится, если в запросе указан HTTP-заголовок skipColumnHeader: true.

Следующие строки содержат статистику — значения полей.

Последняя строка отчета содержит количество строк со статистикой. Строка не выводится, если в запросе указан HTTP-заголовок skipReportSummary: true.

Описание полей представлено в таблице ниже.

Поле

Описание

AdFormat

Формат показа объявления:

IMAGE — графический.
TEXT — текстовый.
VIDEO — видео.
SMART_MULTIPLE — смарт-баннер.
SMART_SINGLE — смарт-объявление.
ADAPTIVE_IMAGE — адаптивный графический.
SMART_TILE — смарт-плитка.
AdGroupId

Идентификатор группы объявлений.

Не отображается в отчете по кампаниям, созданным в Мастере кампаний.

AdGroupName

Название группы объявлений.

Не отображается в отчете по кампаниям, созданным в Мастере кампаний.

AdId

Идентификатор объявления.

Не отображается в отчете по кампаниям, созданным в Мастере кампаний.

AdNetworkType

Тип площадки, где показано объявление:

SEARCH — на поиске;
AD_NETWORK — в сетях.
Age

Возрастная группа пользователя: одно из значений AGE_0_17, AGE_18_24, AGE_25_34, AGE_35_44, AGE_45, AGE_45_54, AGE_55 или UNKNOWN.

В статистике за период до 21.08.2018 выводится значение AGE_45, за период после 21.08.2018 — значения AGE_45_54 и AGE_55. В статистике за период, включающий 21.08.2018, часть строк может содержать значение AGE_45, часть — значение AGE_45_54 или AGE_55.

AvgClickPosition

Средняя позиция, на которой произошел клик по объявлению. При расчете учитываются только клики на первой странице результатов поиска Яндекса. Наивысшая позиция имеет номер 1.

AvgCpc

Средняя стоимость клика.

AvgCpm

Средняя стоимость тысячи показов.

Данные доступны только для медийных кампаний.

AvgEffectiveBid

Средняя ставка за клик с учетом всех корректировок.
Данные доступны только для кампаний с оплатой за клик.

AvgImpressionFrequency

Средняя частота показов одному пользователю, до двух знаков после запятой.

Данные доступны только для медийных кампаний.

AvgImpressionPosition

Средняя позиция показа объявления. При расчете учитываются только показы на первой странице результатов поиска Яндекса. Наивысшая позиция имеет номер 1.

AvgPageviews

Средняя глубина просмотра сайта, то есть количество просмотренных страниц (по данным Яндекс Метрики).

AvgTrafficVolume

Средний объем трафика с позиций, на которых были показы объявления.

AvgVideoCompleteCost

Средняя цена досмотра 100% ролика, в рублях.

BounceRate

Доля отказов в общем количестве визитов, в процентах (по данным Яндекс Метрики).

Bounces

Количество отказов (по данным Яндекс Метрики).

CampaignId

Идентификатор кампании.

CampaignName

Название кампании.

CampaignUrlPath

URL-адрес, указанный в настройках рекламной кампании.

CampaignType

Тип кампании:

TEXT_CAMPAIGN
MOBILE_APP_CAMPAIGN
DYNAMIC_TEXT_CAMPAIGN
SMART_CAMPAIGN
MCBANNER_CAMPAIGN
CPM_BANNER_CAMPAIGN
CPM_DEALS_CAMPAIGN
CPM_FRONTPAGE_CAMPAIGN
CPM_PRICE
UNIFIED_CAMPAIGN
См. раздел Тип кампании.
CarrierType

Тип связи:

CELLULAR — мобильная связь;
STATIONARY — wi-fi или проводной интернет;
UNKNOWN — определить не удалось.
Clicks

Количество кликов.

ClickType

По какой части объявления кликнул пользователь:

TITLE — заголовок объявления. Клик по отображаемой ссылке считается кликом по заголовку.

Примечание

Для графических объявлений, смарт-баннеров, медийных баннеров и баннеров на поиске любой клик по объявлению считается кликом по заголовку.

SITELINK1, SITELINK2, ..., SITELINK8 — быстрые ссылки.

VCARD — визитка.

CHAT — чат с оператором.

PHONE — номер телефона.

MOBILE_APP_ICON — иконка приложения (для рекламы мобильных приложений).

BUTTON — кнопка загрузки/установки (для рекламы мобильных приложений).

PRODUCT_EXTENSIONS — товарные дополнения.

MARKET — Маркет.

UNKNOWN.

ClientLogin

Логин главного представителя клиента.

ConversionRate

Отношение количества целевых визитов к количеству кликов, в процентах (по данным Яндекс Метрики). Может превышать 100, поскольку один клик может быть источником нескольких визитов.

Если в запросе были указаны цели Яндекс Метрики (параметр Goals), вместо поля ConversionRate будут выведены поля ConversionRate_<id_цели>_<модель>.

ConversionRate_<id_цели>_<модель>

Отношение количества целевых визитов, в ходе которых произошло достижение указанной цели, к количеству кликов. Может превышать 100, поскольку один клик может быть источником нескольких визитов. Имя поля содержит идентификатор цели и обозначение модели атрибуции (значение параметра AttributionModels).

Например, поле ConversionRate_1234567_FC содержит долю визитов, в рамках которых произошло достижение цели 1234567, источник визита определен по модели «первый переход».

Если в запросе было указано несколько моделей атрибуции, данные будут выведены по каждой модели в отдельности. Количество полей ConversionRate_<id_цели>_<модель> для каждой модели атрибуции соответствует количеству целей, указанных в параметре Goals.

Conversions

Количество целевых визитов (конверсий) (по данным Яндекс Метрики).

Если в запросе были указаны цели Яндекс Метрики (параметр Goals), вместо поля Conversions будут выведены поля Conversions_<id_цели>_<модель>.

Conversions_<id_цели>_<модель>

Количество целевых визитов (конверсий), в ходе которых произошло достижение указанной цели. Имя поля содержит идентификатор цели и обозначение модели атрибуции (значение параметра AttributionModels).
Например, поле Conversions_1234567_FC содержит количество визитов, в рамках которых произошло достижение цели 1234567, источник визита определен по модели «первый переход».

Если в запросе было указано несколько моделей атрибуции, данные будут выведены по каждой модели в отдельности. Количество полей Conversions_<id_цели>_<модель> для каждой модели атрибуции соответствует количеству целей, указанных в параметре Goals.

Примечание. В ходе одного визита может быть достигнуто несколько целей, поэтому общее количество целевых визитов может быть меньше, чем сумма целевых визитов по отдельным целям.

Cost

Стоимость кликов.

CostPerConversion

Средняя стоимость целевого визита (по данным Яндекс Метрики): отношение стоимости кликов к количеству целевых визитов.

Если в запросе были указаны цели Яндекс Метрики (параметр Goals), вместо поля CostPerConversion будут выведены поля CostPerConversion_<id_цели>_<модель>.

CostPerConversion_<id_цели>_<модель>

Средняя стоимость целевого визита по указанной цели. Имя поля содержит идентификатор цели и обозначение модели атрибуции (значение параметра AttributionModels).

Например, поле CostPerConversion_1234567_FC содержит среднюю стоимость визита, в рамках которого произошло достижение цели 1234567, источник визита определен по модели «первый переход».

Если в запросе было указано несколько моделей атрибуции, данные будут выведены по каждой модели в отдельности. Количество полей CostPerConversion_<id_цели>_<модель> для каждой модели атрибуции соответствует количеству целей, указанных в параметре Goals.

CPV

Средняя цена просмотра ролика, в рублях.

Criteria

Название или текст условия показа:

Для показа по ключевой фразе или синониму — фраза с идентификатором.
Для показа по автотаргетингу — значение «---autotargeting».
Для показа по дополнительной релевантной фразе:
пустое значение, если тип отчета — CUSTOM_REPORT;
текст дополнительной релевантной фразы, если тип отчета — SEARCH_QUERY_PERFORMANCE_REPORT.
Для показа по условию нацеливания на аудиторию — название условия ретаргетинга и подбора аудитории или название интереса к категории мобильных приложений.
Для показа динамического объявления — название условия нацеливания для динамических объявлений или название фильтра.
Для показа смарт-баннера — название фильтра.
Неявно происходит группировка по CriteriaId.

CriteriaId

Идентификатор условия показа:

Для показа по ключевой фразе или синониму — идентификатор фразы.
Для показа по автотаргетингу — идентификатор автотаргетинга.
Для показа по дополнительной релевантной фразе — прочерк.
Для показа по условию нацеливания на аудиторию — идентификатор условия нацеливания на аудиторию.
Для показа динамического объявления — идентификатор условия нацеливания для динамических объявлений или идентификатор фильтра.
Для показа смарт-баннера — идентификатор фильтра.
Не отображается в отчете по кампаниям, созданным в Мастере кампаний.

CriteriaType

Тип условия показа, заданного рекламодателем:

KEYWORD — ключевая фраза.
AUTOTARGETING — автотаргетинг.
AUDIENCE_TARGET — условие нацеливания на аудиторию.
DYNAMIC_TEXT_AD_TARGET — условие нацеливания для динамических объявлений или фильтр для динамических объявлений.
SMART_BANNER_FILTER — фильтр для смарт-баннеров.
Criterion

Название или текст условия показа, заданного рекламодателем:

Для показа по ключевой фразе или синониму — фраза с идентификатором.
Для показа по дополнительной релевантной фразе — текст ключевой фразы, а в случае если ключевую фразу определить не удалось — значение «Автоматически добавленная фраза».
Для показа по автотаргетингу — значение «---autotargeting».
Для показа по условию нацеливания на аудиторию — название условия ретаргетинга и подбора аудитории или название интереса к категории мобильных приложений.
Для показа динамического объявления — название условия нацеливания для динамических объявлений или название фильтра.
Для показа смарт-баннера — название фильтра.
Неявно происходит группировка по CriterionId.

Рекомендуется использовать данное поле вместо поля Criteria.

CriterionId

Идентификатор условия показа, заданного рекламодателем:

Для показа по ключевой фразе или синониму — идентификатор ключевой фразы.
Для показа по дополнительной релевантной фразе — идентификатор ключевой фразы, а в случае если ключевую фразу определить не удалось — прочерк.
Для показа по автотаргетингу — идентификатор автотаргетинга.
Для показа по условию нацеливания на аудиторию (как по условию ретаргетинга и подбора аудитории, так и по интересу к категории мобильных приложений) — идентификатор условия нацеливания на аудиторию, а в случае если условие удалено — прочерк.
Для показа по условию нацеливания для динамических объявлений, генерируемых на основе страниц сайта, — идентификатор условия нацеливания для динамических объявлений.
Для показа по фильтру для динамических объявлений, генерируемых на основе фида, или по фильтру для смарт-баннеров — идентификатор фильтра.
Рекомендуется использовать данное поле вместо поля CriteriaId.

Не отображается в отчете по кампаниям, созданным в Мастере кампаний.

CriterionType

Тип условия показа, заданного рекламодателем:

KEYWORD — ключевая фраза.
AUTOTARGETING — автотаргетинг.
RETARGETING — условие нацеливания на аудиторию по условию ретаргетинга и подбора аудитории.
INTERESTS_AND_DEMOGRAPHICS — условие нацеливания на аудиторию по профилю пользователей.
MOBILE_APP_CATEGORY — условие нацеливания на аудиторию по интересу к категории мобильных приложений.
WEBPAGE_FILTER — условие нацеливания для динамических объявлений, генерируемых на основе страниц сайта.
FEED_FILTER — фильтр для динамических объявлений, генерируемых на основе фида, или фильтр для смарт-баннеров.
OFFER_RETARGETING – офферный ретаргетинг.
Рекомендуется использовать данное поле вместо поля CriteriaType.

Ctr

CTR, в процентах.

Date

Дата, за которую приведена статистика, в формате YYYY-MM-DD.

Device

Тип устройства, на котором было показано объявление: DESKTOP, MOBILE или TABLET.

ExternalNetworkName

Наименование внешней сети (SSP).

Gender

Пол пользователя: GENDER_MALE, GENDER_FEMALE или UNKNOWN.

GoalsRoi

Рентабельность инвестиций в рекламу. Рассчитывается как

(Revenue – Cost) / Cost

До двух знаков после запятой.

Если в запросе были указаны цели Яндекс Метрики (параметр Goals), вместо поля GoalsRoi будут выведены поля GoalsRoi_<id_цели>_<модель>.

GoalsRoi_<id_цели>_<модель>

Рентабельность инвестиций в рекламу по указанной цели. Рассчитывается как

(Revenue_<id_цели>_<модель> – Cost) / Cost

Имя поля содержит идентификатор цели и обозначение модели атрибуции (значение параметра AttributionModels). Например, поле GoalsRoi_1234567_FC содержит рентабельность по цели 1234567, источник визита определен по модели «первый переход».

Если в запросе было указано несколько моделей атрибуции, данные будут выведены по каждой модели в отдельности. Количество полей GoalsRoi_<id_цели>_<модель> для каждой модели атрибуции соответствует количеству целей, указанных в параметре Goals.

ImpressionReach

Охват: количество уникальных пользователей, которым был показан баннер.

Данные доступны только для медийных кампаний.

Примечание

Значения в поле не следует суммировать по строкам отчета, поскольку один и тот же пользователь может быть учтен в нескольких строках. В частности, количество уникальных пользователей для кампании может быть меньше, чем сумма количества уникальных пользователей по отдельным группам объявлений.

Impressions

Количество показов.

IncomeGrade

Уровень платежеспособности пользователя:

VERY_HIGH — топ 1%.
HIGH — 2–5%.
ABOVE_AVERAGE — 6–10%.
OTHER — остальные.
LocationOfPresenceId

Идентификатор региона местонахождения пользователя.

LocationOfPresenceName

Название региона местонахождения пользователя.

MatchedKeyword

Подобранная фраза:

Для показа по синониму ключевой фразы — текст синонима.
Для показа по дополнительной релевантной фразе — текст дополнительной релевантной фразы.
Для показа динамического объявления — текст ключевой фразы, автоматически сформированной на основе страницы рекламируемого сайта или товарного предложения из фида.
В остальных случаях — пустое значение.
MatchType

Тип соответствия ключевой фразе:

RELATED_KEYWORD — показ по дополнительной релевантной фразе.
SYNONYM — показ по семантическому соответствию ключевой фразы.
KEYWORD — показ по ключевой фразе.
NONE — в остальных случаях.
MobilePlatform

Тип операционной системы: ANDROID, IOS, OTHER или UNKNOWN.

Month

Дата начала месяца, в формате YYYY-MM-DD.

Placement

Название площадки показов.

Profit

Прибыль. Рассчитывается как суммарный доход по целям минус стоимость кликов.

Quarter

Дата начала квартала, в формате YYYY-MM-DD.

Query

Поисковый запрос, по которому было показано объявление.

Revenue

Доход по целям. Для ключевых целей рассчитывается исходя из ценностей конверсий, указанных в настройках кампании. Для остальных целей рассчитывается по данным Яндекс Метрики.

Если в запросе были указаны цели Яндекс Метрики (параметр Goals), вместо поля Revenue будут выведены поля Revenue_<id_цели>_<модель>.

Revenue_<id_цели>_<модель>

Доход по указанной цели. Имя поля содержит идентификатор цели и обозначение модели атрибуции (значение параметра AttributionModels).
Например, поле Revenue_1234567_FC содержит доход по цели 1234567, источник визита определен по модели «первый переход».

Если в запросе было указано несколько моделей атрибуции, данные будут выведены по каждой модели в отдельности. Количество полей Revenue_<id_цели>_<модель> для каждой модели атрибуции соответствует количеству целей, указанных в параметре Goals.

RlAdjustmentId

Идентификатор условия ретаргетинга и подбора аудитории, в соответствии с которым применена корректировка ставок для целевой аудитории.

Sessions

Количество визитов (по данным Яндекс Метрики).

Для рекламы мобильных приложений в качестве количества визитов выводится количество кликов.

Slot

Блок показа объявления:

ALONE — эксклюзивное размещение;
PREMIUMBLOCK — спецразмещение;
SUGGEST — реклама в саджесте;
PRODUCT_GALLERY — товарная галерея;
OTHER — другие блоки.
TargetingCategory

Категория таргетинга:

EXACT — целевые запросы. Рекламное объявление точно отвечает на запросы пользователя;
ALTERNATIVE — альтернативные запросы. Пользователь ищет продукт, который можно заменить рекламируемым. При этом объявление также может удовлетворить запрос;
COMPETITOR — запросы с упоминанием конкурентов. Поиск рекламируемого продукта у конкурентов;
BROADER — широкие запросы. Запросы с интересом к продукту, примером которого является рекламное предложение;
ACCESSORY — сопутствующие запросы. Запросы по продуктам, которые могут быть интересны вместе с рекламируемым товаром или услугой.
Поле устарело и скоро перестанет поддерживаться.

Настройки, заданные с помощью API, сконвертируются в веб-интерфейсе по следующим правилам:

API

Веб-интерфейс

Включенная категория EXACT.

Включенные категории «Целевые», «Узкие».

Включенная категория COMPETITOR (если это единственная включенная категория).

Включенная опция упоминания брендов «Конкуренты» + отключение остальных опций упоминания брендов + включение всех категорий.

Включенная категория COMPETITOR (если это не единственная включенная категория).

Включенная опция упоминания брендов «Конкуренты».

Выключенная категория COMPETITOR.

Выключенная опция упоминания брендов «Конкуренты».



Онлайн- и офлайн-отчет
Выбор режима
В зависимости от параметров и объема данных в отчете, сервер Директа может сформировать отчет в режиме онлайн или офлайн. Режим можно указать в HTTP-заголовке запроса processingMode:

processingMode: online
Отчет формируется в режиме онлайн. Если отчет успешно сформирован, он будет передан в теле ответа. Если отчет не может быть сформирован в режиме онлайн, возвращается ошибка.

processingMode: offline
Отчет ставится в очередь на формирование в режиме офлайн. Проверять готовность отчета нужно с помощью повторных запросов с теми же параметрами, см. подраздел Как проверить готовность офлайн-отчета. Рекомендуемый интервал проверки указан в HTTP-заголовке ответа retryIn. Если формирование отчета завершено успешно, сервер возвращает отчет в теле ответа.

processingMode: auto
Сервер автоматически выбирает режим формирования отчета. Если отчет успешно сформирован в режиме онлайн, он будет передан в теле ответа. Если отчет не может быть сформирован в режиме онлайн, он ставится в очередь на формирование в режиме офлайн. Приложение должно поддерживать оба режима.

Отсутствие заголовка эквивалентно значению auto.


Как получить актуальную статистику
Статистика в Директе может уточняться и дополняться. Стандартный период стабилизации данных составляет до трех дней.

В редких случаях статистика может быть скорректирована и за более ранние даты. Как правило, корректировка статистики связана с уменьшением количества кликов и увеличением баланса кампании или общего счета.

Таким образом, может возникнуть расхождение статистики, которую вы получили ранее, с фактическими данными в Директе. Для поддержания актуальности статистики в вашей базе данных мы рекомендуем один из следующих способов:

C помощью метода Changes.check
С помощью DateRangeType: AUTO
C помощью метода Changes.check
Ежедневно (или по выбранному вами расписанию) проверяйте с помощью метода Changes.check, была ли статистика скорректирована:

{
"method": "check",
"params": { 
    "CampaignIds": [...], /* кампании, по которым вы отслеживаете статистику */
    "Timestamp": "...", /* момент, полученный при предыдущем вызове метода */
    "FieldNames": ["CampaignsStat"]
} 
}

Для каждой кампании, статистика по которой была скорректирована после указанного момента, метод возвращает параметр BorderDate.

Если статистика не была скорректирована, получите статистику за последние три дня: в запросе на формирование отчета укажите в параметре DateRangeType значение LAST_3_DAYS. Сохраните в вашей базе данных новую статистику (за вчера) и обновите имеющуюся статистику (за предыдущие два дня).

Если статистика была скорректирована, получите статистику начиная с даты из BorderDate и заканчивая вчерашней датой. Сохраните в вашей базе данных новую статистику (за вчера) и обновите имеющуюся статистику (за предыдущие дни начиная с BorderDate).

С помощью DateRangeType: AUTO
Ежедневно получайте статистику, указывая в параметре DateRangeType значение AUTO. Период, за который формируется отчет, выбирается автоматически в зависимости от того, была ли вчера скорректирована статистика:

Если нет, отчет формируется за три предыдущих дня.

Если да, в качестве начальной даты выбирается самая ранняя дата, за которую статистика была скорректирована; в качестве конечной даты — вчера.

Время выполнения запроса выбирайте ночью по московскому времени, например в 00:23 или 02:47. Избегайте «круглых» значений: это моменты пиковой нагрузки на сервер.

В первой строке полученного отчета указано, за какие даты он сформирован.

Сохраните (обновите) статистику за эти даты в своей базе данных.


Коды ответов и ошибки
HTTP-коды ответов представлены в таблице.

Значение

Описание

200

Отчет успешно сформирован в режиме онлайн

201

Отчет успешно поставлен в очередь на формирование в режиме офлайн

202

Отчет формируется в режиме офлайн

400

Ошибка в запросе или превышен лимит запросов в очереди

500

Ошибка при формировании отчета на сервере

502

Время обработки запроса превысило серверное ограничение.

В случае ошибки возвращается следующая структура:

{
  "error": {
      "request_id": (string),
      "error_code": (int),
      "error_string": (string),
      "error_detail": (string)
  }
}

Объект reports:ApiError

Параметр

Тип

Описание

reports:requestId

string

Уникальный идентификатор запроса, присвоенный сервером API Директа. Также передается в HTTP-заголовке RequestId.

reports:errorCode

int

Числовой код ошибки.

reports:errorMessage

string

Текст сообщения об ошибке.

reports:errorDetail

string

Подробное описание ошибки.

Описание ошибок приведено в разделе Ошибки и предупреждения.



Ограничения
Технические ограничения
В течение 10-секундного интервала можно отправить не более 20 запросов к сервису Reports для одного рекламодателя.

В очереди на формирование могут одновременно находиться не более 5 офлайн-отчетов для одного рекламодателя.

Сформированные офлайн-отчеты хранятся в течение 5 часов, а затем автоматически удаляются.

Доступность данных
Статистика доступна за последние три года от текущего месяца: например, 15 августа 2019 года можно получить данные начиная с 1 августа 2016 года.

Доступность данных в отдельных полях представлена в таблице.

Поле

Данные доступны за период

Query

За последние 180 дней

AvgTrafficVolume

Начиная с 08.06.2018

В предшествующие даты значение AvgTrafficVolume равно 100, значение WeightedCtr совпадает с Ctr, а WeightedImpressions — с Impressions.

WeightedCtr

WeightedImpressions

Доступность данных Яндекс Метрики
Данные по модели атрибуции «Последний переход из Директа» доступны за период начиная с 30.07.2019.
AvgPageviews, Bounces, BounceRate доступны, если на сайте рекламодателя установлен счетчик Яндекс Метрики и номер счетчика указан в параметре кампании CounterIds;
Conversions, ConversionRate, CostPerConversion доступны, если, кроме того, настроены цели для счетчика (см. раздел Цели помощи Яндекс Метрики);
Revenue, Profit и GoalsRoi доступны, если, кроме того, цели указаны как ключевые в настройках кампании (см. раздел Настройка ключевых целей помощи Директа) или если код счетчика передает стоимость заказа (см. раздел Электронная коммерция помощи Яндекс Метрики).
Данные Яндекс Метрики могут попадать в отчет с задержкой вплоть до нескольких часов, поскольку данные, поступающие со счетчиков, необходимо сопоставить с данными по рекламным кампаниям.


